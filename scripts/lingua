#!/usr/bin/env python
import rospy

from lingua_pddl.ccg_reader import CCGReader

from std_msgs.msg import String
from openccg_ros.srv import Parse

class LinguaROS(object):
  def __init__(self):
    super(LinguaROS, self).__init__()

    self.sub_speech = rospy.Subscriber('/speech', String, self.speech_cb)
    self.parser = rospy.ServiceProxy('/ccg/parse', Parse)

  def speech_cb(self, msg):
    # Get XML parses from CCG parser for input text
    result = self.parser(msg.data)

    for xml in result.parses:
      t = self.transform(xml)

      if t:
        print(t)

  def transform(self, xml):
    return CCGReader.read(xml)

  def run(self):
    rospy.spin()

# task = CCGReader.read('<xml><lf><satop nom="w2:object"><prop name="ball"/><diamond mode="det"><prop name="the"/></diamond><diamond mode="num"><prop name="sg"/></diamond><diamond mode="mod"><nom name="w1:color"/><prop name="red"/></diamond></satop></lf><target>the red ball</target></xml>')
# print(task)
if __name__ == '__main__':
  rospy.init_node('lingua')

  lingua = LinguaROS()
  lingua.run()